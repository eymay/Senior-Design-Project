%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% !TEX root = interimreport.tex
%\clearpage
\chapter{REALISTIC CONSTRAINTS AND CONCLUSIONS}\label{Ch6}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

In this thesis, the process of modifying a compiler backend extension to support a custom extended processor is presented from various aspects. LLVM compiler infrastructure is used as the compiler design environment. We explained RISC-V standard extensions and the ASCON encryption algorithm for background information. 

Our findings indicate that custom instruction design is a critical task. RISC-V standard extensions should be considered and analyzed. Instructions should be designed by considering both hardware and software. Our analysis of the S-box indicates that as the patterns get larger or contain high-level information, different compiler stages such as the middle-end should be considered as well. This work presents various pattern matching schemes and example implementations that the reader will have an intuition about the process of adding any custom instruction to the compiler. 

In Chapter \ref{Ch2}, the common structure of the compilers is presented to give general knowledge about the compilers and expand the reader’s view on compiler structure. Following this in Chapter \ref{ch:Ch3}, LLVM compiler infrastructure is explained. Clang frontend, LLVM optimizer and LLVM RISC-V backend are described. LLVM optimizer is described with a case study tracing the optimizations on LLVM IR. In Chapter \ref{ch:riscv}, RISC-V standard extensions are presented. It is emphasized that using standard extensions can reduce the necessary compiler support workload for hardware developers. In Chapter \ref{Chascon}, the ASCON algorithm is presented briefly to provide background information about the target hardware. In Chapter \ref{Ch4}, LLVM RISC-V backend was analyzed by tracing the transformations of a simple high-level code being compiled down to assembly instructions. We explained how assembly codes are generated through LLVM’s compilation steps. In Chapter \ref{ch:custom_instr}, we showed how to add an instruction to an LLVM backend using TableGen and C++. We discussed that adding an instruction can be designed in two steps, assembler support and pattern matching. We emphasized that assembler support can be implemented in Instruction Selection however pattern matching can be covered in different regions of the compiler. In Chapter \ref{Ch9}, we presented our collection of custom instructions with two new instructions proposed, LXR and NAXOR for the ASCON application. In Chapter \ref{Ch10}, we explained how to validate a newly added instruction and set up testing infrastructure. We believe that this work will inspire future work in the related area.
\section{Practical Application of This Project}
This project can be useful for increasing the efficiency of applications that require the frequent use of specific instructions. Cryptography applications with RISC-V may be one of these.

\section{Realistic Constraints}
LLVM is a huge infrastructure and while working with it, sometimes it may be hard to find what you are looking for. Also, there aren’t many sources or documentation to find solutions to the specific problems that we encounter which sometimes slows down the progress.

\subsection{Social, Environmental, and Economic Impact}
The end product is going to help the custom processor to be programmed by a high-level programming language. It will make the programming of the custom processor a more efficient process and encourage the use of the custom processor. Because of this efficiency, the energy and time costs would be reduced during the programming of the processor. Also, using a custom processor for handling a problem is faster and requires less power. Therefore, encouraging the use of one would be another benefit of the end product.

\subsection{Cost Analysis}
Open-source tools and programs were used on our computers during the project. Therefore, it wasn’t costly for us.

\pagebreak
\subsection{Standards}
LLVM project is very selective in the technologies they use. Latest versions of C++ and build tools with software engineering principles are followed. Instructions abide by the RISC-V instruction set standard.

\subsection{Health and Safety Concerns}
Since we are working in software area, there is no possible risk of harm to users.

\section{Future Work and Recommendations}
For the pattern matching process, we recommend future work to focus on LLVM IR transformations and optimizations. As discussed in Section \ref{sec:patmatchdisc}, LLVM IR provides flexibility to perform source matching and transformation and thus pattern matching. For more complicated patterns MLIR is recommended to be focused on. Despite it being under active development, MLIR provides higher level pattern matching potential.

For LLVM RISC-V backend, we recommend working on GlobalISel which is developed to replace SelectionDAG. GlobalISel may have fewer limitations than SelectionDAG so it can be useful for complex patterns. GlobalISel has a modular pass-based structure which is easier to work with than the monolithic SelectionDAG.
